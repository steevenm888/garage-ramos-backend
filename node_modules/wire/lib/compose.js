'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _immutable = require('immutable');

var _castFilemap = require('./castFilemap');

var _castFilemap2 = _interopRequireDefault(_castFilemap);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

/**
 * Compose a list of transforms into a single transform that runs as an asynchronous series of
 * steps.
 *
 * Also casts to filemap before and after each step, so your transforms may be 'loose' if need be.
 * @public
 */

const compose = (...fns) => {
  const composedTransform = async _files => {
    let files = _files || (0, _immutable.Map)();

    for (const fn of fns) {
      if (!fn) continue;

      files = (0, _castFilemap2.default)(files);

      files = await Promise.resolve(fn(files));
    }

    return (0, _castFilemap2.default)(files);
  };

  return composedTransform;
};

exports.default = compose;